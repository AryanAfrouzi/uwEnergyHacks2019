firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    //get id token
    user.getIdToken().then(function(idToken) {
      userIdToken = idToken;
    });

    // User is signed in.

    document.getElementById("user_div").style.display = "block";
    document.getElementById("login_div").style.display = "none";

    var user = firebase.auth().currentUser;

    if(user != null){

      var email_id = user.email;
      document.getElementById("user_para").innerHTML = "Welcome User : " + email_id;

    }

  } else {
    // No user is signed in.

    document.getElementById("user_div").style.display = "none";
    document.getElementById("login_div").style.display = "block";

  }
});

function login(){
  var userEmail = document.getElementById("email_field").value;
  var userPass = document.getElementById("password_field").value;

  firebase.auth().signInWithEmailAndPassword(userEmail, userPass).catch(function(error) {
    // Handle Errors here.
    var errorCode = error.code;
    var errorMessage = error.message;

    window.alert("Error : " + errorMessage);

    // ...
  });

}

function logout(){
  firebase.auth().signOut();
}

function submitLocation() {
  var start = $('location_start').val();
  var destination = $('location_destination').val();
  $.ajax(databaseURL + 'destination', {
    headers: {
      'Authorization': 'Bearer ' + userIdToken,
      'Access-Control-Allow-Origin': '*'
    },
    method: 'POST',
    data: JSON.stringify({'start': start, 'destination': destination}),
    contentType : 'application/json'
  }).then(function(data){
    drawRoute(start, destination, data);
  });
} 

$(document).on('click', ".car-type", function () {
  $('.selected-car').removeClass('active');
  $('.selected-car').removeClass('selected-car');
  $(this).addClass('active');
  $(this).addClass('selected-car');
});

var data = [[43.46974, -80.58091], [43.46971, -80.58093], [43.46969, -80.58097], [43.4697, -80.58109], [43.46968, -80.58116], [43.46968, -80.58136], [43.4697, -80.58149], [43.46996, -80.58199], [43.47012, -80.58213], [43.47052, -80.58054], [43.47053, -80.58003], [43.4708, -80.57993], [43.47135, -80.57965], [43.4716, -80.57963], [43.47172, -80.57965], [43.47182, -80.57969], [43.47215, -80.57975], [43.47216, -80.57974], [43.47217, -80.57973], [43.47219, -80.57973], [43.47222, -80.57962], [43.47233, -80.57931], [43.47239, -80.57915], [43.4725, -80.57899], [43.47279, -80.57831], [43.47359, -80.57651], [43.4745, -80.57435], [43.47471, -80.57386], [43.47475, -80.57369], [43.47489, -80.57241], [43.47486, -80.57224], [43.47494, -80.57226], [43.47588, -80.57233], [43.47608, -80.57234], [43.47635, -80.5723], [43.47653, -80.57224], [43.47676, -80.57217], [43.47717, -80.57197], [43.47803, -80.57142], [43.48048, -80.56985], [43.48097, -80.56954], [43.48141, -80.56926], [43.48161, -80.5691], [43.48169, -80.56902], [43.48173, -80.56897], [43.48183, -80.56881], [43.48246, -80.56773], [43.48281, -80.56693], [43.48314, -80.56614], [43.48317, -80.56596], [43.48351, -80.56508], [43.48389, -80.56417], [43.4842, -80.56333], [43.48436, -80.56284], [43.48443, -80.56225], [43.48448, -80.56217], [43.48448, -80.56201], [43.48447, -80.56175], [43.48443, -80.5614], [43.4843, -80.56086], [43.48292, -80.55599], [43.48286, -80.55567], [43.48283, -80.55532], [43.48286, -80.55485], [43.48289, -80.55464], [43.48295, -80.55429], [43.48303, -80.55404], [43.48381, -80.55191], [43.48422, -80.55081], [43.48478, -80.5493], [43.48531, -80.54786], [43.48543, -80.54748], [43.48552, -80.54709], [43.48564, -80.54647], [43.48567, -80.54603], [43.48567, -80.54564], [43.48564, -80.54527], [43.48558, -80.54487], [43.48512, -80.54243], [43.48506, -80.54206], [43.48503, -80.54157], [43.48504, -80.54136], [43.48508, -80.5411], [43.48529, -80.54042], [43.4833, -80.53863], [43.48299, -80.53838], [43.48246, -80.53802], [43.48186, -80.53758], [43.47921, -80.53565], [43.47865, -80.53526], [43.47828, -80.53505], [43.47662, -80.53384], [43.47701, -80.53272], [43.47732, -80.53133], [43.47761, -80.52991], [43.47773, -80.52879], [43.47786, -80.52769], [43.47804, -80.52599], [43.47788, -80.52596], [43.47787, -80.526], [43.47787, -80.52606], [43.47786, -80.52607], [43.4778, -80.52609], [43.47772, -80.52608], [43.47766, -80.52605], [43.47766, -80.52591], [43.47769, -80.52592], [43.4777, -80.52585], [43.47773, -80.52556], [43.4777, -80.52553], [43.47735, -80.52546]]
//Maps Javascript API
function initMap() {
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 13,
    center: {lat: 43.46974, lng: -80.58091}
  });
}


function drawRoute(start, end, points, map) {
  var route = []
  for(i=0; i < data.length; i++) {
    route.push({lat: data[i][0], lng: data[i][1]})
  }
  var drivingRoute = new google.maps.Polyline({
    path: route,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: 2
  });

  drivingRoute.setMap(map);
}

/* function showRoute(directionsService, directionsDisplay, data) {
  var data = [[43.46974, -80.58091], [43.46971, -80.58093], [43.46969, -80.58097], [43.4697, -80.58109], [43.46968, -80.58116], [43.46968, -80.58136], [43.4697, -80.58149], [43.46996, -80.58199], [43.47012, -80.58213], [43.47052, -80.58054], [43.47053, -80.58003], [43.4708, -80.57993], [43.47135, -80.57965], [43.4716, -80.57963], [43.47172, -80.57965], [43.47182, -80.57969], [43.47215, -80.57975], [43.47216, -80.57974], [43.47217, -80.57973], [43.47219, -80.57973], [43.47222, -80.57962], [43.47233, -80.57931], [43.47239, -80.57915], [43.4725, -80.57899], [43.47279, -80.57831], [43.47359, -80.57651], [43.4745, -80.57435], [43.47471, -80.57386], [43.47475, -80.57369], [43.47489, -80.57241], [43.47486, -80.57224], [43.47494, -80.57226], [43.47588, -80.57233], [43.47608, -80.57234], [43.47635, -80.5723], [43.47653, -80.57224], [43.47676, -80.57217], [43.47717, -80.57197], [43.47803, -80.57142], [43.48048, -80.56985], [43.48097, -80.56954], [43.48141, -80.56926], [43.48161, -80.5691], [43.48169, -80.56902], [43.48173, -80.56897], [43.48183, -80.56881], [43.48246, -80.56773], [43.48281, -80.56693], [43.48314, -80.56614], [43.48317, -80.56596], [43.48351, -80.56508], [43.48389, -80.56417], [43.4842, -80.56333], [43.48436, -80.56284], [43.48443, -80.56225], [43.48448, -80.56217], [43.48448, -80.56201], [43.48447, -80.56175], [43.48443, -80.5614], [43.4843, -80.56086], [43.48292, -80.55599], [43.48286, -80.55567], [43.48283, -80.55532], [43.48286, -80.55485], [43.48289, -80.55464], [43.48295, -80.55429], [43.48303, -80.55404], [43.48381, -80.55191], [43.48422, -80.55081], [43.48478, -80.5493], [43.48531, -80.54786], [43.48543, -80.54748], [43.48552, -80.54709], [43.48564, -80.54647], [43.48567, -80.54603], [43.48567, -80.54564], [43.48564, -80.54527], [43.48558, -80.54487], [43.48512, -80.54243], [43.48506, -80.54206], [43.48503, -80.54157], [43.48504, -80.54136], [43.48508, -80.5411], [43.48529, -80.54042], [43.4833, -80.53863], [43.48299, -80.53838], [43.48246, -80.53802], [43.48186, -80.53758], [43.47921, -80.53565], [43.47865, -80.53526], [43.47828, -80.53505], [43.47662, -80.53384], [43.47701, -80.53272], [43.47732, -80.53133], [43.47761, -80.52991], [43.47773, -80.52879], [43.47786, -80.52769], [43.47804, -80.52599], [43.47788, -80.52596], [43.47787, -80.526], [43.47787, -80.52606], [43.47786, -80.52607], [43.4778, -80.52609], [43.47772, -80.52608], [43.47766, -80.52605], [43.47766, -80.52591], [43.47769, -80.52592], [43.4777, -80.52585], [43.47773, -80.52556], [43.4777, -80.52553], [43.47735, -80.52546]]
  var waypts = ['531 Havendale Pl, Waterloo, ON N2T 2T3', '255 King St N #9, Waterloo, ON N2J 4V2, Canada'];
  var route = []
  for(i=0; i < data.length; i++) {
    route.push({lat: data[i][0], lng: data[i][1]})
  }

  var drivingRoute = new google.maps.Polyline({
    path: route,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: 2
  });

  drivingRoute.setMap(map);


  directionsService.route({
    origin: '531 Havendale Pl, Waterloo, ON N2T 2T3',
    destination: '255 King St N #9, Waterloo, ON N2J 4V2, Canada',
    waypoints: waypts,
    optimizeWaypoints: true,
    travelMode: 'DRIVING'
  }, function(response, status) {
    if (status === 'OK') {
      directionsDisplay.setDirections(response);
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  }); 
} */





